#Start tmux on login
[ -z "$TMUX" ] && { tmux attach || exec tmux new-session  && exit; }

# General env
export PATH="$HOME/go/bin:/usr/local/opt/bison/bin:/opt/chefdk/bin:$HOME/.rbenv/shims:$PATH:$HOME/scripts:/usr/local/bin:$HOME/.cargo/bin:$HOME/src/bindplane/bindplane-scripts/bin"
export LANG=en_US.UTF-8
export TERM=xterm-256color
export EDITOR=nvim
export USE_EDITOR=$EDITOR
export VISUAL=$EDITOR
export COLORTERM=truecolor

# Vulkan env
export VULKAN_SDK="$HOME/.vulkan_sdk/macOS"
export PATH="$VULKAN_SDK/bin:$PATH"
export DYLD_LIBRARY_PATH="$VULKAN_SDK/lib:$DYLD_LIBRARY_PATH"
export VK_ICD_FILENAMES="$VULKAN_SDK/etc/vulkan/icd.d/MoltenVK_icd.json"
export VK_LAYER_PATH="$VULKAN_SDK/etc/vulkan/explicit_layer.d"
export SHADERC_LIB_DIR="$VULKAN_SDK/lib"

# Lang env
export GROOVY_HOME="/usr/local/opt/groovy/libexec"
export GOPATH="$HOME/go"
export RUST_SRC_PATH=/Users/ccheek/.rustup/toolchains/nightly-x86_64-apple-darwin/lib/rustlib/src/rust/src

# Personal env
export BINDPLANE_AWS_USERNAME=ccheek""
export BINDPLANE_HOME="$HOME/src/bindplane"
export NR_JMX_TOOL="$HOME/bluemedora/nrjmx/bin/nrjmx"
export FZF_CTRL_T_COMMAND='command cat <(fre --sorted) <(fd -t d) <(fd -t d . ~)'
export FZF_CTRL_T_OPTS='--tiebreak=index'
export PROD_API="https://bplog-api.bindplane.bluemedora.com"
export DEV_API="https://b4vmn9ra2i.execute-api.us-east-1.amazonaws.com/dev"

fpath=("$HOME/.config/zsh/functions" $fpath)

# Shell Aliases
alias bp=bindplane
alias doco='docker-compose'
alias note='nvim -c "cd ~/notes" ~/notes/index.md'
alias jot='nvim -c "cd ~/notes" ~/notes/jots.md'
alias ls='exa'
alias nv='nvim'
alias sudo='sudo '
alias pubkey="cat ~/.ssh/id_rsa.pub | pbcopy | echo '=> Public key copied to pasteboard.'"
alias cat='bat'
alias clip='pbcopy'
alias mv='mv -i'

# Copy path to file
function cpth() {
    realpath $1 | xargs echo -n | pbcopy
}

function pass() {
  session=$(bw unlock | sed -n 's/$ export BW_SESSION="\(.*\)"/\1/p')
  export BW_SESSION="${session%%[[:space:]]}"
  name=$(bw list items | jq -r '.[].name' | fzf)
  bw get password "${name}" | tr -d '\n' | pbcopy
}

# Config editing aliases

alias ez='nvim ~/.zshrc && source ~/.zshrc'
alias ev='nvim ~/.config/nvim/init.vim'
alias et='nvim ~/.tmux.conf'

# Git Aliases

alias ga='git add'
alias gap='git add --patch'
alias gsup='git submodule init && git submodule update'
alias gc='git commit -m'
alias gl='git pull --prune'
alias gp='git push --follow-tags origin HEAD'
alias gd='git diff'
alias gco='git checkout'
alias gcl='git clean -dix'
alias gb='git branch'
alias gs='git status -sb'
alias gac='git add -A && git commit -m'
alias gsum='git log --graph --decorate --pretty=oneline --abbrev-commit'

zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'
autoload -U async && async
autoload -Uz compinit && compinit
autoload -Uz promptinit
compinit
promptinit
prompt pure

# History

HISTFILE=$HOME/.zsh_history
HISTSIZE=100000
SAVEHIST=100000
setopt append_history
setopt extended_history
setopt hist_ignore_space
setopt hist_verify
setopt share_history
setopt hist_ignore_dups

# Directory Options

setopt auto_pushd
setopt pushd_ignore_dups
setopt pushd_silent
setopt extended_glob

# Define Word Endings

WORDCHARS='*?+[]~=&;!#$%^(){}<>'

# Emacs keybindings
# for more info, man zshzle
bindkey -e

# Theme

#source "$HOME/.dotfiles/zsh/zsh-theme.zsh"

setopt extended_glob


source ~/.dotfiles/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
setopt INTERACTIVE_COMMENTS
ZSH_HIGHLIGHT_STYLES[comment]='fg=gray'

# FZF options
#
source "$HOME/.dotfiles/zsh/fzf-key-bindings.zsh"

# Update fre on directory change
fre_chpwd() {
  fre --add "$(pwd)"
}
typeset -gaU chpwd_functions
chpwd_functions+=fre_chpwd

eval "$(nodenv init -)"

