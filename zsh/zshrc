#Start tmux on login
[ -z "$TMUX" ] && { tmux attach || exec tmux new-session  && exit; }

# General env
export PATH="$HOME/go/bin:/usr/local/opt/bison/bin:/opt/chefdk/bin:$HOME/.rbenv/shims:$PATH:$HOME/scripts:/usr/local/bin:$HOME/.cargo/bin:$HOME/src/bindplane/bindplane-scripts/bin"
export LANG=en_US.UTF-8
export TERM=screen-256color
export EDITOR=nvim
export USE_EDITOR=$EDITOR
export VISUAL=$EDITOR
export COLORTERM=truecolor
export GPG_TTY=$(tty)
export LC_CTYPE=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# Lang env
export GOPATH="$HOME/go"

# Personal env
export BINDPLANE_AWS_USERNAME=ccheek""
export BINDPLANE_HOME="$HOME/src/bindplane"
export FZF_CTRL_T_COMMAND='command cat <(fre --sorted) <(fd -t d)'
export FZF_CTRL_T_OPTS='--tiebreak=index --bind tab:down --bind shift-tab:up'
export BP_AGENT_HOME="$HOME/go/src/go.bluemedora.com/bpagent/testbed/darwin"

fpath=("$HOME/.config/zsh/functions" $fpath)

# Shell Aliases
alias bp=bindplane
alias note='nvim ~/notes/scratch.md'
alias ls='exa'
alias pubkey="cat ~/.ssh/id_rsa.pub | pbcopy | echo '=> Public key copied to pasteboard.'"
alias cat='bat'
alias mv='mv -i'
alias nb='jotr'

# Copy path to file
function cpth() {
    realpath $1 | xargs echo -n | pbcopy
}

# Config editing aliases
alias ez='nvim ~/.zshrc && source ~/.zshrc'
alias ev='nvim ~/.config/nvim/init.vim'
alias et='nvim ~/.tmux.conf'

# Git Aliases
alias ga='git add'
alias gap='git add --patch'
alias gsup='git submodule init && git submodule update'
alias gc='git commit -m'
alias gl='git pull --prune'
alias gp='git push --follow-tags origin HEAD'
alias gd='git diff'
alias gco='git checkout'
alias gcl='git clean -dix'
alias gb='git branch'
alias gs='git status -sb'
alias gac='git add -A && git commit -m'
alias gsum='git log --graph --decorate --pretty=oneline --abbrev-commit'

# zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'
# _zpcompinit_custom() {
#   setopt extendedglob local_options
#   autoload -Uz compinit
#   local zcd=${ZDOTDIR:-$HOME}/.zcompdump
#   local zcdc="$zcd.zwc"
#   # Compile the completion dump to increase startup speed, if dump is newer or doesn't exist,
#   # in the background as this is doesn't affect the current session
#   if [[ -f "$zcd"(#qN.m+1) ]]; then
#         compinit -i -d "$zcd"
#         { rm -f "$zcdc" && zcompile "$zcd" } &!
#   else
#         compinit -C -d "$zcd"
#         { [[ ! -f "$zcdc" || "$zcd" -nt "$zcdc" ]] && rm -f "$zcdc" && zcompile "$zcd" } &!
#   fi
# }

# _zpcompinit_custom
source <(~/.cargo/bin/starship init zsh --print-full-init)

# History
HISTFILE=$HOME/.zsh_history
HISTSIZE=100000
SAVEHIST=100000
setopt append_history
setopt extended_history
setopt hist_ignore_space
setopt hist_verify
setopt share_history
setopt hist_ignore_dups

# Directory Options
setopt auto_pushd
setopt pushd_ignore_dups
setopt pushd_silent
setopt extended_glob

# Define Word Endings
WORDCHARS='*?+[]~=&;!#$%^(){}<>'

# Emacs keybindings
# for more info, man zshzle
bindkey -e

source ~/.dotfiles/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
setopt INTERACTIVE_COMMENTS
ZSH_HIGHLIGHT_STYLES[comment]='fg=gray'

# FZF options
source "$HOME/.dotfiles/zsh/fzf-key-bindings.zsh"

# Update fre on directory change
fre_chpwd() {
  fre --add "$(pwd)"
}
typeset -gaU chpwd_functions
chpwd_functions+=fre_chpwd
